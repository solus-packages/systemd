From 54881efb88b2e778c5679f1ce3ab7cc8d2114cd3 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 8 Oct 2017 18:22:07 +0100
Subject: [PATCH 2/3] systemctl: Don't emit a reload warning for
 systemd-cryptsetup

This is modified by dracut during early boot, so instead of a nice clean
prompt for the password, the user is presented with a scary warning about
things being modified on disk, that they cannot possibly understand isn't
actually a bad thing.

This simply skips all reload warnings for the transient dracut unit on
Solus for systemd-cryptsetup, as this was generated *only* for the boot
unit.

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 src/systemctl/systemctl.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/src/systemctl/systemctl.c b/src/systemctl/systemctl.c
index f218bb0..12ed58a 100644
--- a/src/systemctl/systemctl.c
+++ b/src/systemctl/systemctl.c
@@ -2975,8 +2975,12 @@ static int start_unit_one(
         if (r < 0)
                 return bus_log_parse_error(r);
 
-        if (need_daemon_reload(bus, name) > 0)
-                warn_unit_file_changed(name);
+        /* Skip systemd-cryptsetup@ in early boot. No need for fear. */
+        if (need_daemon_reload(bus, name) > 0) {
+                if (!(strncmp(name, "systemd-cryptsetup@", 19) == 0 && arg_scope == UNIT_FILE_SYSTEM)) {
+                        warn_unit_file_changed(name);
+                }
+        }
 
         if (w) {
                 log_debug("Adding %s to the set", path);
-- 
2.14.2

